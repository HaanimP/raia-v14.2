<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RAiA V14.2</title>

  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Your main CSS -->
  <link rel="stylesheet" href="styles.css"/>
</head>

<body>

  <!-- System Limitations Banner -->
  <div class="system-banner">
    <i class="fas fa-info-circle"></i>
    RAiA is a decision-support tool. Final regulatory decisions remain the responsibility of the human reviewer.
    <a href="#" id="learnMoreLink" style="color: white; text-decoration: underline; margin-left: 0.5rem;">Learn what RAiA can/cannot do</a>
  </div>
  
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>RAiA</h1>
        <div class="version">Version 14.2</div>
      </div>
      
      <!-- SECTION 8: Training Mode Toggle -->
      <div class="training-mode-toggle">
        <input type="checkbox" id="trainingModeToggle">
        <label for="trainingModeToggle">Training Mode</label>
      </div>
      
      <!-- Progress Indicator -->
      <div class="progress-indicator">
        <div class="label">Overall Progress</div>
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="overallProgress" style="width: 0%"></div>
        </div>
        <div class="progress-stats">
          <span id="progressLabel">Getting started...</span>
          <span id="progressPercent">0%</span>
        </div>
      </div>
      
      <!-- Setup Workflow -->
      <div class="workflow-section">
        <div class="workflow-title">1. Setup</div>
        <div class="nav-item" id="nav-dashboard">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </div>
        <div class="nav-item" id="nav-submit">
          <i class="fas fa-upload"></i>
          <span>Submit Files</span>
        </div>
        <div class="nav-item" id="nav-mapping">
          <i class="fas fa-sitemap"></i>
          <span>CTD Mapping</span>
        </div>
      </div>
      
      <!-- Review Workflow -->
      <div class="workflow-section">
        <div class="workflow-title">2. Review</div>
        <div class="nav-item" id="nav-analysis">
          <i class="fas fa-search"></i>
          <span>Findings</span>
        </div>
        <div class="nav-item" id="nav-rules">
          <i class="fas fa-gavel"></i>
          <span>Rules</span>
        </div>
        <div class="nav-item" id="nav-knowledge">
          <i class="fas fa-book"></i>
          <span>Knowledge Base</span>
        </div>
      </div>
      
      <!-- Finalize Workflow -->
      <div class="workflow-section">
        <div class="workflow-title">3. Finalize</div>
        <div class="nav-item" id="nav-history">
          <i class="fas fa-history"></i>
          <span>Audit Trail</span>
        </div>
        <div class="nav-item" id="nav-report">
          <i class="fas fa-file-alt"></i>
          <span>Assessment Report</span>
        </div>
      </div>
      
      <!-- Settings -->
      <div class="workflow-section">
        <div class="nav-item" id="nav-settings">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </div>
        <div class="nav-item" id="nav-help">
          <i class="fas fa-question-circle"></i>
          <span>Help</span>
        </div>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main class="content">
      <!-- SECTION 5: Error Banner -->
      <div class="error-banner" id="errorBanner">
        <div class="error-header">
          <i class="fas fa-exclamation-triangle"></i>
          <span id="errorTitle">Error Occurred</span>
        </div>
        <div class="error-message" id="errorMessage"></div>
        <div class="error-recovery" id="errorRecovery"></div>
        <button class="button secondary" id="dismissError">Dismiss</button>
      </div>
      
      <!-- Dashboard Page -->
      <section id="page-dashboard" class="page active">
        <div class="page-header">
          <h1>Dashboard</h1>
          <p>Manage your regulatory dossiers and review activities.</p>
        </div>
        
        <!-- SECTION 1: Primary Action Card -->
        <div id="primaryActionContainer"></div>
        
        <!-- SECTION 1: Toggle for Secondary Actions -->
        <div class="toggle-secondary">
          <button id="toggleSecondaryBtn">
            <i class="fas fa-chevron-down"></i> Show All Dossiers
          </button>
        </div>
        
        <!-- SECTION 1: Secondary Actions (Hidden by Default) -->
        <div class="secondary-actions" id="secondaryActions">
          <div class="card">
            <div class="card-header">
              <span><i class="fas fa-plus-circle"></i> Create New Dossier</span>
            </div>
            <div class="input-group">
              <label for="newName">Dossier Name *</label>
              <input id="newName" type="text" placeholder="e.g., Artemether-Lumefantrine 80/480mg Tablets">
            </div>
            <div class="input-group">
              <label for="newAuthority">Regulatory Authority *</label>
              <select id="newAuthority">
                <option value="">Select authority...</option>
                <option value="SAHPRA">SAHPRA (South Africa)</option>
                <option value="TMDA">TMDA (Tanzania)</option>
                <option value="BoMRA">BoMRA (Botswana)</option>
              </select>
            </div>
            <div class="input-group">
              <label for="newPathway">Reliance Pathway *</label>
              <select id="newPathway">
                <option value="">Select pathway...</option>
                <option value="Abridged">Abridged (Identical product)</option>
                <option value="Verified">Verified (Minor differences)</option>
                <option value="Recognition">Recognition (Direct acceptance)</option>
              </select>
            </div>
            <!-- SECTION 8: Training Hint -->
            <div class="training-hint" id="hint-create-dossier">
              <i class="fas fa-lightbulb hint-icon"></i>
              <strong>Training Tip:</strong> Choose your reliance pathway carefully. "Abridged" requires identical products with sameness declarations, while "Verified" allows minor differences with justification.
            </div>
            <button class="button" id="createDossierBtn">
              <i class="fas fa-folder-plus"></i> Create Dossier
            </button>
          </div>
          
          <div class="card">
            <div class="card-header">
              <span><i class="fas fa-folder-open"></i> Your Dossiers</span>
            </div>
            <div id="projectList"></div>
          </div>
        </div>
      </section>
      
      <!-- Submit Files Page -->
      <section id="page-submit" class="page">
        <div class="page-header">
          <h1>Submit Files</h1>
          <p>Upload all documents related to your dossier. Supports PDF, Word, images, and ZIP archives.</p>
        </div>
        
        <div class="card">
          <div class="file-pool" id="dropzone" style="border-style: dashed; cursor: pointer; text-align: center; padding: 3rem;">
            <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #cbd5e0; margin-bottom: 1rem;"></i>
            <div style="font-weight: 600; margin-bottom: 0.5rem;">Click or drag files here to upload</div>
            <div class="text-muted text-sm">Supports: PDF, DOC, DOCX, TXT, MD, CSV, JSON, Images, ZIP</div>
          </div>
          <input id="fileInput" type="file" multiple class="hidden" />
          
          <!-- SECTION 4: Upload Progress -->
          <div class="upload-progress" id="uploadProgress">
            <div class="upload-status">
              <span id="uploadStatusText">Uploading files...</span>
              <span id="uploadPercentage">0%</span>
            </div>
            <div class="upload-progress-bar">
              <div class="upload-progress-fill" id="uploadProgressFill"></div>
            </div>
            <div class="upload-file-list" id="uploadFileList"></div>
          </div>
        </div>
        
        <!-- SECTION 8: Training Hint -->
        <div class="training-hint" id="hint-file-upload">
          <i class="fas fa-lightbulb hint-icon"></i>
          <strong>Training Tip:</strong> Upload Module 1 (administrative) files first, then move to Modules 2-5. This helps maintain logical organization during CTD mapping.
        </div>
        
        <div class="card" id="filesCard">
          <div class="card-header">
            <span><i class="fas fa-file"></i> Uploaded Files</span>
            <span class="text-muted text-sm" id="fileCount">0 files</span>
          </div>
          <div id="fileList"></div>
        </div>
        
        <div class="card" id="guidelinesCard">
          <div class="card-header">
            <i class="fas fa-lightbulb"></i> Submission Guidance
          </div>
          <div id="guidelinesContainer"></div>
        </div>
      </section>
      
      <!-- CTD Mapping Page -->
      <section id="page-mapping" class="page">
        <div class="page-header">
          <h1>CTD Mapping</h1>
          <p>Assign uploaded files to appropriate CTD modules and sections. Drag files from the left panel to CTD nodes on the right.</p>
        </div>
        
        <div class="status-grid">
          <div class="status-card">
            <div class="label">Files Mapped</div>
            <div class="value" id="mappedCount">0 / 0</div>
          </div>
          <div class="status-card warning">
            <div class="label">Unmapped Files</div>
            <div class="value" id="unmappedCount">0</div>
          </div>
          <div class="status-card success">
            <div class="label">Mapping Complete</div>
            <div class="value" id="mappingPercent">0%</div>
          </div>
        </div>
        
        <!-- SECTION 8: Training Hint -->
        <div class="training-hint" id="hint-ctd-mapping">
          <i class="fas fa-lightbulb hint-icon"></i>
          <strong>Training Tip:</strong> Use "Suggest Mappings" to auto-assign files based on filenames. Always review suggestions before running compliance checks.
        </div>
        
        <div style="margin-bottom: 1rem;">
          <button class="button secondary" id="suggestMappingsBtn">
            <i class="fas fa-magic"></i> Suggest Mappings
          </button>
          <button class="button secondary" id="clearMappingsBtn">
            <i class="fas fa-eraser"></i> Clear All Mappings
          </button>
        </div>
        
        <div class="ctd-mapping-container">
          <div class="file-pool">
            <div class="file-pool-header">
              <span>Unmapped Files</span>
              <span class="count" id="poolCount">0</span>
            </div>
            <div id="filePoolList"></div>
          </div>
          
          <div class="ctd-tree">
            <div class="file-pool-header">
              <span>CTD Structure</span>
            </div>
            <div id="ctdTreeContainer"></div>
          </div>
        </div>
      </section>
      
      <!-- Findings/Analysis Page -->
      <section id="page-analysis" class="page">
        <div class="page-header">
          <h1>Findings & Analysis</h1>
          <p>Review compliance findings and risk assessment for your dossier.</p>
        </div>
        
        <div class="status-grid" id="analysisSummary">
          <!-- Populated dynamically -->
        </div>
        
        <div class="card">
          <button class="button" id="runAnalysisBtn">
            <i class="fas fa-play-circle"></i> Run Compliance Check
          </button>
          <button class="button secondary" id="exportBtn" style="margin-left: 0.5rem;">
            <i class="fas fa-download"></i> Export Dossier
          </button>
          <input id="importFile" type="file" accept="application/json" class="hidden" />
        </div>
        
        <!-- SECTION 8: Training Hint -->
        <div class="training-hint" id="hint-findings">
          <i class="fas fa-lightbulb hint-icon"></i>
          <strong>Training Tip:</strong> Critical findings must be resolved before approval. Use "Explain" to understand why each finding was flagged, then document your decision using Accept/Dispute buttons.
        </div>
        
        <div class="findings-dashboard" id="findingsDashboard">
          <!-- Populated dynamically -->
        </div>
      </section>
      
      <!-- Rules Page -->
      <section id="page-rules" class="page">
        <div class="page-header">
          <h1>Rules & Compliance Criteria</h1>
          <p>View and manage regulatory rules used for compliance checking.</p>
        </div>
        
        <div class="card">
          <div id="rulesContainer"></div>
          <div style="margin-top: 1rem;">
            <button class="button secondary" id="resetRulesBtn">
              <i class="fas fa-undo"></i> Reset to Defaults
            </button>
          </div>
        </div>
      </section>
      
      <!-- Audit History Page -->
      <section id="page-history" class="page">
        <div class="page-header">
          <h1>Audit Trail</h1>
          <p>Complete history of all actions performed on this dossier with cryptographic verification.</p>
        </div>
        
        <div class="card">
          <div id="historyContainer"></div>
        </div>
      </section>
      
      <!-- Assessment Report Page -->
      <section id="page-report" class="page">
        <div class="page-header">
          <h1>Assessment Report</h1>
          <p>Generate a formal assessment report for regulatory submission.</p>
        </div>
        
        <div class="card">
          <div class="card-header">Report Configuration</div>
          <div class="input-group">
            <label for="reportRecommendation">Final Recommendation</label>
            <select id="reportRecommendation">
              <option value="">Select recommendation...</option>
              <option value="approve">Approve for Market Authorization</option>
              <option value="reject">Reject Application</option>
              <option value="clarification">Request Clarification</option>
            </select>
          </div>
          <div class="input-group">
            <label for="reportNotes">Assessment Notes</label>
            <textarea id="reportNotes" placeholder="Enter summary notes for the assessment report..."></textarea>
          </div>
          <button class="button" id="generateReportBtn">
            <i class="fas fa-file-pdf"></i> Generate PDF Report
          </button>
        </div>
      </section>
      
      <!-- Knowledge Base Page -->
      <section id="page-knowledge" class="page">
        <div class="page-header">
          <h1>Knowledge Base</h1>
          <p>Upload and search regulatory guidelines, compendia, and reference materials.</p>
        </div>
        
        <div class="card">
          <div id="kbDropzone" style="border: 2px dashed #cbd5e0; padding: 2rem; text-align: center; cursor: pointer; border-radius: 8px;">
            <i class="fas fa-book-medical" style="font-size: 2.5rem; color: #cbd5e0; margin-bottom: 0.75rem;"></i>
            <div style="font-weight: 600;">Upload Knowledge Base Files</div>
            <div class="text-muted text-sm">Guidelines, compendia, reference documents</div>
          </div>
          <input id="kbInput" type="file" multiple class="hidden" />
        </div>
        
        <div class="card">
          <div class="input-group">
            <label for="kbSearch">Search Knowledge Base</label>
            <input id="kbSearch" type="text" placeholder="Search for regulatory guidance...">
          </div>
          <div id="kbResults"></div>
        </div>
      </section>
      
      <!-- Settings Page -->
      <section id="page-settings" class="page">
        <div class="page-header">
          <h1>Settings</h1>
          <p>Configure application preferences and user profile.</p>
        </div>
        
        <div class="card">
          <div class="card-header">User Settings</div>
          <div class="input-group">
            <label for="roleSelect">User Role</label>
            <select id="roleSelect">
              <option value="reviewer">Reviewer (Standard access)</option>
              <option value="admin">Administrator (Full access)</option>
            </select>
          </div>
          <div class="input-group">
            <label>
              <input id="darkModeToggle" type="checkbox">
              Enable dark mode
            </label>
          </div>
          <div class="input-group">
            <label>
              <input id="persistToggle" type="checkbox">
              Enable local data persistence
            </label>
          </div>
        </div>
      </section>
      
      <!-- Help Page -->
      <section id="page-help" class="page">
        <div class="page-header">
          <h1>Help & Documentation</h1>
          <p>Learn how to use RAiA effectively for regulatory dossier review.</p>
        </div>
        
        <div class="card">
          <div class="card-header">Getting Started</div>
          <ol style="margin-left: 1.5rem; line-height: 1.8;">
            <li><strong>Create a Dossier:</strong> Start by creating a new dossier project with the appropriate authority and reliance pathway.</li>
            <li><strong>Upload Files:</strong> Submit all regulatory documents (CTD modules, assessment reports, etc.).</li>
            <li><strong>Map to CTD:</strong> Assign each file to the correct CTD module and section.</li>
            <li><strong>Run Analysis:</strong> Execute compliance checks using authority-specific rules.</li>
            <li><strong>Review Findings:</strong> Examine all flagged issues, review evidence, and document decisions.</li>
            <li><strong>Generate Report:</strong> Create a formal assessment report for submission.</li>
          </ol>
        </div>
        
        <div class="card">
          <div class="card-header">What RAiA Can Do</div>
          <ul style="margin-left: 1.5rem; line-height: 1.8;">
            <li>Organize and structure regulatory dossiers according to CTD format</li>
            <li>Identify potential compliance issues using predefined regulatory rules</li>
            <li>Calculate risk scores based on severity and likelihood</li>
            <li>Maintain tamper-evident audit trails of all actions</li>
            <li>Generate structured assessment reports</li>
            <li>Search across dossier content and knowledge bases</li>
          </ul>
        </div>
        
        <div class="card">
          <div class="card-header">What RAiA Cannot Do</div>
          <ul style="margin-left: 1.5rem; line-height: 1.8;">
            <li>Make final regulatory decisions (human reviewer retains full responsibility)</li>
            <li>Replace expert scientific judgment or clinical assessment</li>
            <li>Guarantee detection of all compliance issues</li>
            <li>Interpret complex regulatory nuances without human review</li>
            <li>Validate the scientific merit or quality of studies</li>
          </ul>
        </div>
      </section>
    </main>
  </div>
  
  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Modal Title</h3>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>
  
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p style="margin-top: 1rem; color: #4a5568; font-weight: 500;">Processing...</p>
  </div>

<!-- =========================================================
 SCRIPTS
========================================================= -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<!-- ðŸ‘‰ PASTE YOUR FULL JS LOGIC HERE -->
<script src="app.js"></script>

</body>
</html>